{{ define "main" }}
{{ $contact := .Site.Data.en.contact }}
{{ $contactInfo := .Site.Data.contact_info }}

<!-- Contact Section -->
<section class="wrapper style1">
    <div class="container">

        <div class="contact-grid">
            <div class="contact-methods">
                <div class="section-header">
                    <h3><i class="fas fa-phone-alt"></i> {{ $contact.contact_methods.title }}</h3>
                    <p>{{ $contact.contact_methods.subtitle }}</p>
                </div>
                
                <div class="contact-cards-grid">
                    {{ range $method := $contact.contact_methods.methods }}
                    {{ $showMethod := false }}
                    {{ $value := "" }}
                    {{ $link := "" }}
                    
                    {{ if eq $method.type "email" }}
                        {{ with $contactInfo.email }}
                            {{ $showMethod = true }}
                            {{ $value = . }}
                            {{ $link = printf "mailto:%s" . }}
                        {{ end }}
                    {{ else if eq $method.type "phone" }}
                        {{ with $contactInfo.phone }}
                            {{ $showMethod = true }}
                            {{ $value = . }}
                            {{ $link = $contactInfo.phone_link }}
                        {{ end }}
                    {{ else if eq $method.type "whatsapp" }}
                        {{ with $contactInfo.whatsapp }}
                            {{ if and .number .link }}
                                {{ $showMethod = true }}
                                {{ $value = .number }}
                                {{ $link = .link }}
                            {{ end }}
                        {{ end }}
                    {{ end }}
                    
                    {{ if $showMethod }}
                    <div class="contact-card">
                        <div class="card-inner">
                            <div class="contact-icon">
                                <i class="{{ $method.icon }}"></i>
                            </div>
                            <div class="contact-details">
                                <h4>{{ $method.name }}</h4>
                                <div class="contact-value">
                                    <a href="{{ $link }}">{{ $value }}</a>
                                </div>
                                <div class="contact-description">
                                    {{ $method.description }}
                                </div>
                            </div>
                        </div>
                    </div>
                    {{ end }}
                    {{ end }}
                </div>

                <!-- Map Section -->
                <div class="locations-map-section">
                    <div class="section-header">
                        <h3><i class="fas fa-map-marked-alt"></i> Our Locations</h3>
                        <p>Cambridge, UK & Islamabad, Pakistan</p>
                    </div>
                    
                    <div class="map-container">
                        <div id="locations-map"></div>
                    </div>
                </div>
            </div>

            <div class="contact-form-section">
                <div class="section-header">
                    <h3><i class="fas fa-envelope"></i> {{ $contact.contact_form.title }}</h3>
                    <p>{{ $contact.contact_form.subtitle }}</p>
                </div>
                
                <form class="contact-form" action="{{ $contactInfo.formspree_endpoint }}" method="POST">
                    {{ range $contact.contact_form.fields }}
                    <div class="form-group">
                        <label for="{{ .name }}">{{ .label }}{{ if .required }} *{{ end }}</label>
                        <div class="input-wrapper">
                            {{ if .icon }}
                            <div class="input-icon">
                                <i class="{{ .icon }}"></i>
                            </div>
                            {{ end }}
                            
                            {{ if eq .type "textarea" }}
                                <textarea id="{{ .name }}" name="{{ .name }}" {{ if .required }}required{{ end }} {{ with .placeholder }}placeholder="{{ . }}"{{ end }}></textarea>
                            {{ else if eq .type "select" }}
                                <select id="{{ .name }}" name="{{ .name }}"{{ if .required }} required{{ end }}>
                                    <option value="">Select an option</option>
                                    {{ range .options }}
                                    <option value="{{ . }}">{{ . }}</option>
                                    {{ end }}
                                </select>
                            {{ else }}
                                <input type="{{ .type }}" id="{{ .name }}" name="{{ .name }}"
                                       {{ if .required }}required{{ end }}
                                       {{ with .placeholder }}placeholder="{{ . }}"{{ end }}>
                            {{ end }}
                        </div>
                    </div>
                    {{ end }}
                    
                    <button type="submit" class="submit-button">
                        <i class="fas fa-paper-plane"></i>
                        {{ $contact.contact_form.submit_text }}
                    </button>
                </form>
            </div>
        </div>
    </div>
</section>

<style>
.locations-map-section {
    margin-top: 3em;
}

.locations-map-section .section-header {
    margin-bottom: 1.5em;
    text-align: center;
}

.locations-map-section .section-header h3 {
    margin-bottom: 0.5em;
}

.locations-map-section .section-header h3 i {
    margin-right: 0.5em;
}

.map-container {
    width: 100%;
    height: 600px;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    border: 2px solid #e0e0e0;
}

#locations-map {
    width: 100%;
    height: 100%;
}

@media screen and (max-width: 980px) {
    .map-container {
        height: 500px;
    }
}

@media screen and (max-width: 736px) {
    .map-container {
        height: 400px;
    }
    
    .locations-map-section {
        margin-top: 2em;
    }
}
</style>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize the map centered between Cambridge and Islamabad
    var map = L.map('locations-map').setView([40, 35], 3);
    
    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 18,
    }).addTo(map);
    
    // Custom icon for markers
    var customIcon = L.divIcon({
        className: 'custom-marker',
        html: '<div style="background: #3c7d7d; width: 30px; height: 30px; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); border: 3px solid white; box-shadow: 0 3px 10px rgba(0,0,0,0.3);"><div style="transform: rotate(45deg); color: white; font-size: 16px; margin-top: 2px; margin-left: 5px;">üìç</div></div>',
        iconSize: [30, 30],
        iconAnchor: [15, 30],
        popupAnchor: [0, -30]
    });
    
    // Cambridge, UK coordinates
    var cambridge = L.marker([52.2053, 0.1218], {icon: customIcon}).addTo(map);
    cambridge.bindPopup('<div style="text-align: center; font-weight: 600; color: #3c7d7d;">üìç Cambridge, UK</div>');
    
    // Islamabad, Pakistan coordinates
    var islamabad = L.marker([33.6844, 73.0479], {icon: customIcon}).addTo(map);
    islamabad.bindPopup('<div style="text-align: center; font-weight: 600; color: #3c7d7d;">üìç Islamabad, Pakistan</div>');
    
    // Fit the map to show both markers
    var group = L.featureGroup([cambridge, islamabad]);
    map.fitBounds(group.getBounds().pad(0.2));
});
</script>

{{ end }}
